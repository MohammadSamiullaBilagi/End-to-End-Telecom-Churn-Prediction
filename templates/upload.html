<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8">
  <title>Telecom Churn - Upload CSV</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

  <!-- Theme CSS -->
  <style>
    /* Light theme variables */
    :root {
      --bg-color: #f8f9fa;
      --text-color: #212529;
      --card-bg: #ffffff;
      --muted-color: #6c757d;
      --input-bg: #ffffff;
      --border-color: #dee2e6;
      --btn-text: #ffffff;
      --btn-bg-primary: #0d6efd;
      --btn-bg-warning: #ffc107;
      --btn-bg-secondary: #6c757d;
      --table-row-alt: rgba(0,0,0,0.02);
    }

    /* Dark theme variables */
    [data-theme='dark'] {
      --bg-color: #0b1220;
      --text-color: #e6eef8;
      --card-bg: #071029;
      --muted-color: #9aa7b2;
      --input-bg: #0f1724;
      --border-color: #263241;
      --btn-text: #0b1220;
      --btn-bg-primary: #0ea5a4;
      --btn-bg-warning: #f59e0b;
      --btn-bg-secondary: #4b5563;
      --table-row-alt: rgba(255,255,255,0.02);
    }

    body {
      background-color: var(--bg-color) !important;
      color: var(--text-color) !important;
      transition: background 0.18s ease, color 0.18s ease;
    }
    .card, .card-body {
      background-color: var(--card-bg) !important;
      color: var(--text-color) !important;
      border: 1px solid var(--border-color) !important;
    }

    /* Headings, labels and muted text */
    h1,h2,h3,h4,h5,h6, .card-title, .form-label, label, small, .text-muted, .text-muted a {
      color: var(--text-color) !important;
    }
    .text-muted { color: var(--muted-color) !important; }

    /* Inputs */
    .form-control, input[type="file"], select, textarea {
      background-color: var(--input-bg) !important;
      color: var(--text-color) !important;
      border: 1px solid var(--border-color) !important;
    }

    /* Buttons */
    .btn-primary {
      background-color: var(--btn-bg-primary) !important;
      color: var(--btn-text) !important;
      border-color: transparent !important;
    }
    .btn-warning {
      background-color: var(--btn-bg-warning) !important;
      color: var(--btn-text) !important;
      border-color: transparent !important;
    }
    .btn-secondary {
      background-color: var(--btn-bg-secondary) !important;
      color: var(--btn-text) !important;
      border-color: transparent !important;
    }

    /* Alert */
    .alert {
      background-color: rgba(255,255,255,0.02);
      color: var(--text-color) !important;
      border-color: var(--border-color) !important;
    }

    /* Theme toggle */
    .theme-toggle-btn {
      position: absolute;
      top: 20px;
      right: 30px;
      padding: 6px 15px;
      color: var(--text-color) !important;
      background: transparent !important;
      border: 1px solid var(--border-color) !important;
    }

    /* ========================
       TABLE / pandas HTML fixes
       ========================
       These override both normal CSS and inline styles that pandas may emit.
    */
    table.dataframe, table, .dataframe {
      width: 100% !important;
      border-collapse: collapse !important;
      background: transparent !important;
      color: var(--text-color) !important;
    }

    /* headers and cells */
    table.dataframe th,
    table.dataframe td,
    table th, table td,
    .dataframe th, .dataframe td {
      background: transparent !important;
      color: var(--text-color) !important;
      border: 1px solid var(--border-color) !important;
      padding: .5rem .6rem !important;
      vertical-align: top !important;
    }

    /* override inline style backgrounds if pandas put white bg on cells */
    table.dataframe th[style],
    table.dataframe td[style],
    .dataframe th[style],
    .dataframe td[style] {
      background: transparent !important;
      color: var(--text-color) !important;
    }

    /* header style */
    table.dataframe thead th,
    .dataframe thead th {
      font-weight: 600 !important;
      text-align: left !important;
      background: rgba(255,255,255,0.01) !important;
    }

    /* alternating row shading for readability */
    table.dataframe tbody tr:nth-child(even),
    .dataframe tbody tr:nth-child(even) {
      background: var(--table-row-alt) !important;
    }

    /* links inside table */
    table.dataframe a, .dataframe a {
      color: var(--text-color) !important;
      text-decoration: underline !important;
    }

    /* ensure small text inside table is visible */
    table.dataframe small, .dataframe small { color: var(--muted-color) !important; }

    .high-contrast { color: var(--text-color) !important; }
  </style>
</head>

<body>

<button id="themeToggle" class="btn theme-toggle-btn" onclick="toggleTheme()">üåô Dark Mode</button>

<div class="container py-5">
  <div class="card mx-auto" style="max-width:820px;">
    <div class="card-body">
      <h3 class="card-title mb-3 high-contrast">Telecom Churn Prediction</h3>

      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <div class="alert alert-info">
            {% for msg in messages %}
              <div>{{ msg }}</div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <div class="row">
        <div class="col-md-7">
          <form method="post" action="{{ url_for('predict') }}" enctype="multipart/form-data">
            <div class="mb-3">
              <label class="form-label high-contrast">Upload CSV</label>
              <input class="form-control" type="file" name="file" accept=".csv" required>
            </div>
            <button class="btn btn-primary">Upload & Predict</button>
          </form>
        </div>

        <div class="col-md-5">
          <form method="post" action="{{ url_for('train') }}">
            <p class="small text-muted">Train the model using the training pipeline.</p>
            {% if has_training_pipeline %}
              <button class="btn btn-warning" type="submit">Train Model</button>
            {% else %}
              <button class="btn btn-secondary" disabled>Train Model (Unavailable)</button>
            {% endif %}
          </form>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Theme Toggle Script -->
<script>
  function toggleTheme() {
    const html = document.documentElement;
    const current = html.getAttribute("data-theme");
    const newTheme = current === "light" ? "dark" : "light";
    html.setAttribute("data-theme", newTheme);
    localStorage.setItem("theme", newTheme);

    // Update button label
    const btn = document.getElementById("themeToggle");
    btn.textContent = newTheme === "light" ? "üåô Dark Mode" : "‚òÄÔ∏è Light Mode";
  }

  // Load saved theme on page load
  (function() {
    const saved = localStorage.getItem("theme") || "light";
    document.documentElement.setAttribute("data-theme", saved);
    const btn = document.getElementById("themeToggle");
    if (btn) btn.textContent = saved === "light" ? "üåô Dark Mode" : "‚òÄÔ∏è Light Mode";
  })();
</script>

</body>
</html>
